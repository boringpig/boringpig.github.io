<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>FileSystem - Amazon S3 - Jeffery Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="FileSystem 我認為是必學的，因為一個專案不可能沒有個人帳戶或是商業網站不可能沒有商品瀏覽等等，這些都跟上傳檔案與圖片有關，練習階段可以先在本機端測試，但如果專案要上線就要找一個雲端的服務可以儲存檔案，我選擇 Amazon S3 除了免費之外，也可以設定使用者的權限等等，重點是 Laravel 預設的 FileSystems 之一，所以只要安裝 Adapter 就可以運行">
<meta property="og:type" content="article">
<meta property="og:title" content="FileSystem - Amazon S3">
<meta property="og:url" content="http://boringpig.github.io/Laravel/FileSystem-Amazon-S3/index.html">
<meta property="og:site_name" content="Jeffery Blog">
<meta property="og:description" content="FileSystem 我認為是必學的，因為一個專案不可能沒有個人帳戶或是商業網站不可能沒有商品瀏覽等等，這些都跟上傳檔案與圖片有關，練習階段可以先在本機端測試，但如果專案要上線就要找一個雲端的服務可以儲存檔案，我選擇 Amazon S3 除了免費之外，也可以設定使用者的權限等等，重點是 Laravel 預設的 FileSystems 之一，所以只要安裝 Adapter 就可以運行">
<meta property="og:image" content="http://boringpig.github.io/images/laravel/Laravel5.2.png">
<meta property="og:image" content="https://i.imgur.com/g6kPPpZ.png">
<meta property="og:image" content="https://i.imgur.com/cYEZ5Y7.png">
<meta property="og:image" content="https://i.imgur.com/ODQF0GQ.png">
<meta property="og:updated_time" content="2016-09-19T08:36:56.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="FileSystem - Amazon S3">
<meta name="twitter:description" content="FileSystem 我認為是必學的，因為一個專案不可能沒有個人帳戶或是商業網站不可能沒有商品瀏覽等等，這些都跟上傳檔案與圖片有關，練習階段可以先在本機端測試，但如果專案要上線就要找一個雲端的服務可以儲存檔案，我選擇 Amazon S3 除了免費之外，也可以設定使用者的權限等等，重點是 Laravel 預設的 FileSystems 之一，所以只要安裝 Adapter 就可以運行">
<meta name="twitter:image" content="http://boringpig.github.io/images/laravel/Laravel5.2.png">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/bootstrap.css">
  <link rel="stylesheet" href="/css/font-awesome.min.css">
  

</head>

<body>
  <div id="container">
    <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/categories">Categories</a>
        
          <a class="main-nav-link" href="/tags">Tags</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://boringpig.github.io"></form>
        </div>
      </nav>
    </div>
  </div>
</header>
    <section id="main" class="outer"><article id="post-FileSystem-Amazon-S3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h4 class="article-title" itemprop="name">
      FileSystem - Amazon S3
    </h4>
  


      </header>
    
    <div class="article-meta">
      <a href="/Laravel/FileSystem-Amazon-S3/" class="article-date">
  <time datetime="2016-09-19T08:30:09.000Z" itemprop="datePublished">2016-09-19</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Laravel/">Laravel</a>
  </div>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <img src="/images/laravel/Laravel5.2.png" width="650">
<p>FileSystem 我認為是必學的，因為一個專案不可能沒有個人帳戶或是商業網站不可能沒有商品瀏覽等等，這些都跟上傳檔案與圖片有關，練習階段可以先在本機端測試，但如果專案要上線就要找一個雲端的服務可以儲存檔案，我選擇 Amazon S3 除了免費之外，也可以設定使用者的權限等等，重點是 Laravel 預設的 FileSystems 之一，所以只要安裝 Adapter 就可以運行<br><a id="more"></a></p>
<h1 id="Version"><a href="#Version" class="headerlink" title="Version"></a>Version</h1><p>Laravel 5.2.31</p>
<hr>
<h1 id="Content"><a href="#Content" class="headerlink" title="Content"></a>Content</h1><h2 id="實作-FileSystem"><a href="#實作-FileSystem" class="headerlink" title="實作 FileSystem"></a>實作 FileSystem</h2><h3 id="Step-1-註冊-AWS-S3"><a href="#Step-1-註冊-AWS-S3" class="headerlink" title="Step 1 註冊 AWS S3"></a>Step 1 註冊 AWS S3</h3><p>先去 <a href="https://aws.amazon.com/tw/s3/?sc_channel=PS&amp;sc_campaign=acquisition_TW&amp;sc_publisher=google&amp;sc_medium=s3_b&amp;sc_content=s3_e&amp;sc_detail=aws%20s3&amp;sc_category=s3&amp;sc_segment=71575236756&amp;sc_matchtype=e&amp;sc_country=TW&amp;s_kwcid=AL!4422!3!71575236756!e!!g!!aws%20s3&amp;ef_id=V4Y9lwAABD@hr7Sy:20160916150441:s" target="_blank" rel="external">Amazon官網</a> 註冊帳號，選擇 S3 的產品服務，建立一個 Bucket</p>
<p><img src="https://i.imgur.com/g6kPPpZ.png" alt=""></p>
<p>取得 AWS 的 credentials</p>
<p><img src="https://i.imgur.com/cYEZ5Y7.png" alt=""></p>
<h3 id="Step-2-設定-env、config"><a href="#Step-2-設定-env、config" class="headerlink" title="Step 2 設定 .env、config"></a>Step 2 設定 .env、config</h3><p>到 .env</p>
<figure class="highlight plain"><figcaption><span>&nbsp;&nbsp;&nbsp;.env</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">S3_KEY=&apos;你的KEY&apos;</div><div class="line">S3_SECRET=&apos;你的SECRET&apos;</div><div class="line">S3_REGION=&apos;你選擇的區域&apos;</div><div class="line">S3_BUCKET=&apos;建立的BUCKET NAME&apos;</div></pre></td></tr></table></figure>
<p>到 config/filesystems.php</p>
<figure class="highlight plain"><figcaption><span>&nbsp;&nbsp;&nbsp;config/filesystems.php</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">return [</div><div class="line">  &apos;cloud&apos; =&gt; &apos;s3&apos;,</div><div class="line">  &apos;disks&apos; =&gt; [</div><div class="line">     &apos;s3&apos; =&gt; [</div><div class="line">        &apos;driver&apos; =&gt; &apos;s3&apos;,</div><div class="line">        &apos;key&apos; =&gt; env(&apos;S3_KEY&apos;),</div><div class="line">        &apos;secret&apos; =&gt; env(&apos;S3_SECRET&apos;),</div><div class="line">        &apos;region&apos; =&gt; env(&apos;S3_REGION&apos;),</div><div class="line">        &apos;bucket&apos; =&gt; env(&apos;S3_BUCKET&apos;),</div><div class="line">     ],</div><div class="line">  ]</div><div class="line">]</div></pre></td></tr></table></figure>
<h3 id="Step-3-安裝-AWS-Adapter"><a href="#Step-3-安裝-AWS-Adapter" class="headerlink" title="Step 3 安裝 AWS Adapter"></a>Step 3 安裝 AWS Adapter</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">composer require league/flysystem-aws-s3-v3</div></pre></td></tr></table></figure>
<p>到 controller 裡，測試一下是否連線</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$s3 = \Storage::cloud();</div><div class="line">dd($s3);</div></pre></td></tr></table></figure>
<p>看到這畫面就代表連線成功啦～</p>
<p><img src="https://i.imgur.com/ODQF0GQ.png" alt=""></p>
<table>
<thead>
<tr>
<th>語法</th>
<th>內容</th>
</tr>
</thead>
<tbody>
<tr>
<td>Storage::disk(‘磁碟’)</td>
<td>指定要儲存的磁碟位置</td>
</tr>
<tr>
<td>Storage::get(‘檔案’)</td>
<td>讀取檔案內容以字串形式呈現</td>
</tr>
<tr>
<td>Storage::has(‘路徑’)</td>
<td>判斷檔案是否存在</td>
</tr>
<tr>
<td>Storage::size(‘檔案’)</td>
<td>讀取檔案的大小</td>
</tr>
<tr>
<td>Storage::lastModified(‘檔案’)</td>
<td>讀取檔案最後修改日期</td>
</tr>
<tr>
<td>Storage::put(‘路徑’, ‘檔案’, ‘權限’)</td>
<td>將檔案上傳到磁碟</td>
</tr>
<tr>
<td>Storage::copy(‘路徑’, ‘路徑’)</td>
<td>將檔案複製到指定的位置</td>
</tr>
<tr>
<td>Storage::move(‘路徑’, ‘路徑’)</td>
<td>將檔案搬移到指定的位置</td>
</tr>
<tr>
<td>Storage::prepend(‘檔案’, ‘文字’)</td>
<td>將文字插入到檔案的開頭</td>
</tr>
<tr>
<td>Storage::append(‘檔案’, ‘文字’)</td>
<td>將文字插入到檔案的結尾</td>
</tr>
<tr>
<td>Storage::delete([‘檔案’, ‘檔案’])</td>
<td>可刪除一到多個檔案</td>
</tr>
</tbody>
</table>
<p>熟悉以上的語法，就可以上傳檔案到雲端位置囉～</p>
<h3 id="補充-Intervention-Image-套件"><a href="#補充-Intervention-Image-套件" class="headerlink" title="補充 - Intervention Image 套件"></a>補充 - Intervention Image 套件</h3><p>每個人上傳的圖片大小、格式、位置等等不同，如果未先處理好會增加伺服器的負擔，且顯示圖片的方式會不一致造成不美觀，這個 <a href="http://image.intervention.io/getting_started/introduction" target="_blank" rel="external">Intervention Image</a> 套件可以幫我們的問題解決</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">composer require intervention/image</div></pre></td></tr></table></figure>
<p>到 config/app.php</p>
<figure class="highlight php"><figcaption><span>&nbsp;&nbsp;&nbsp;config/app.php</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="string">'providers'</span> =&gt; [</div><div class="line">    Intervention\Image\ImageServiceProvider::class</div><div class="line"> ],</div><div class="line"></div><div class="line"><span class="string">'aliases'</span> =&gt; [</div><div class="line">    <span class="string">'Image'</span> =&gt; Intervention\Image\Facades\Image::class</div><div class="line"> ]</div></pre></td></tr></table></figure>
<p>官方的文件提供很多 <a href="http://image.intervention.io/api/make" target="_blank" rel="external">API 的方法</a> 可以使用看看，我示範上傳圖片前基本處理的方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$file = $request-&gt;file(<span class="string">'image'</span>);  <span class="comment">//先取到上傳的圖片</span></div><div class="line">$fileName = time() . <span class="string">'.jpg'</span>; <span class="comment">//將圖片命名</span></div><div class="line">$image = (string) Image::make($file)-&gt;encode(<span class="string">'jpg'</span>, <span class="number">75</span>)-&gt;resize(<span class="number">300</span>, <span class="number">300</span>); <span class="comment">//使用套件的方法將圖片處理成自定義的格式檔案</span></div><div class="line">$filePath = <span class="string">'avatars/'</span> . $fileName; <span class="comment">//儲存的圖片路徑</span></div><div class="line"></div><div class="line">Storage::cloud()-&gt;put($filePath, $image, <span class="string">'public'</span>); <span class="comment">//上傳到 AWS S3</span></div></pre></td></tr></table></figure>
<p>試看看吧～</p>
<hr>
<h1 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h1><h5 id="Laravel官方文件-FileSystem"><a href="#Laravel官方文件-FileSystem" class="headerlink" title="Laravel官方文件-FileSystem"></a><a href="https://laravel.tw/docs/5.2/filesystem" target="_blank" rel="external">Laravel官方文件-FileSystem</a></h5><h5 id="Upload-Files-to-AWS-S3-using-Laravel"><a href="#Upload-Files-to-AWS-S3-using-Laravel" class="headerlink" title="Upload Files to AWS S3 using Laravel"></a><a href="https://chrisblackwell.me/upload-files-to-aws-s3-using-laravel/" target="_blank" rel="external">Upload Files to AWS S3 using Laravel</a></h5><h5 id="UPLOADING-DIRECTLY-TO-AMAZON-S3-FROM-YOUR-LARAVEL-5-APPLICATION"><a href="#UPLOADING-DIRECTLY-TO-AMAZON-S3-FROM-YOUR-LARAVEL-5-APPLICATION" class="headerlink" title="UPLOADING DIRECTLY TO AMAZON S3 FROM YOUR LARAVEL 5 APPLICATION"></a><a href="https://return-true.com/uploading-directly-to-amazon-s3-from-your-laravel-5-application/" target="_blank" rel="external">UPLOADING DIRECTLY TO AMAZON S3 FROM YOUR LARAVEL 5 APPLICATION</a></h5><hr>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AWS/">AWS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Laravel-5-2/">Laravel 5.2</a></li></ul>

      </footer>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/Laravel/View-Composers/" id="article-nav-newer" class="article-nav-link-wrap">
      <div class="article-nav-title"><span>&lt;</span>&nbsp;
        
          View Composers
        
      </div>
    </a>
  
  
    <a href="/Laravel/Form-Reuse-Model-Binding/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Form Reuse &amp; Model Binding&nbsp;<span>&gt;</span></div>
    </a>
  
</nav>

  
</article>




<div class="share_addthis">
  <div class="sharing addthis_toolbox share">
    <a class="addthis_button_facebook_like"></a>
    <a class="addthis_button_tweet"></a>
    <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-560c64c35486b3d4" async="async"></script>
</div>





</section>
    

<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/bootstrap.min.js"></script>

  </div>
</body>
</html>
